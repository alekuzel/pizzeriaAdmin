"use strict";var urlA="https://studenter.miun.se/~alku2200/writeable/webbutveckling3/webservice/restMenu.php",urlB="https://studenter.miun.se/~alku2200/writeable/webbutveckling3/webservice/restBooking.php",mealNameInput=document.getElementById("mealName"),categoryInput=document.getElementById("category"),priceInput=document.getElementById("price"),descriptionInput=document.getElementById("description"),submitInput=document.getElementById("submit"),submitLogout=document.getElementById("logout");function init(){getMenu(),getBookings(),showToken()}function getMenu(){fetch(urlA).then((function(e){if(200==e.status)return e.json().then((function(e){return displayMenu(e)}))}))}function logoutUser(){localStorage.removeItem("token"),window.location.replace("https://studenter.miun.se/~alku2200/writeable/webbutveckling3/admin/pub/login.html")}function addMeal(e){e.preventDefault();var t=mealNameInput.value,n=categoryInput.value,a=priceInput.value,o=descriptionInput.value,i=JSON.stringify({name:t,description:o,category:n,price:a});fetch(urlA,{method:"POST",headers:{"content-type":"application/json"},body:i}).then((function(e){return e.json()})).then((function(e){return clearForm()})),alert("New meal added!"),getMenu()}function getBookings(){fetch(urlB).then((function(e){if(200==e.status)return e.json().then((function(e){return displayBookings(e)}))}))}function displayBookings(e){var t=document.getElementById("bookings");t.innerHTML="",e.forEach((function(e){t.innerHTML+='<div class="bookingDiv">\n    <p> <b id="clientsname'.concat(e.id,'">').concat(e.name,'</b>\n    <b id="clientslastname').concat(e.id,'">').concat(e.lastname,'</b></p>\n    <p><b>Tel.:</b>  <span id="phone').concat(e.id,'">').concat(e.phone,'</span></p>\n    <p><b>E-mail: </b> <span id="email').concat(e.id,'">').concat(e.email,'</span></p>\n    <p><b>Date: </b><span id="date').concat(e.id,'" contenteditable>').concat(e.date,'</span></p>\n    <p><b>Time: </b> <span id="time').concat(e.id,'" contenteditable>').concat(e.time,'</span></p>\n    <p><b>Number of people: </b> <span id="numpeople').concat(e.id,'" contenteditable>').concat(e.numberofpeople,'</span></p>\n    <p><button data-id="').concat(e.id,'" class="upd">UPDATE</button>\n    <button data-id="').concat(e.id,'" class="del">DELETE</button></p>\n    </div>')}));for(var n=document.getElementsByClassName("del"),a=document.getElementsByClassName("upd"),o=0;o<n.length;o++)n[o].addEventListener("click",deleteBooking),a[o].addEventListener("click",updateBooking)}function deleteBooking(e){var t=e.target.dataset.id;1==confirm("Delete the booking?")?fetch(urlB+"?id="+t,{method:"DELETE"}).then((function(e){return e.json()})).then((function(e){alert("Booking deleted!"),getBookings()})).catch((function(e){return console.log(e)})):getBookings()}function updateBooking(e){var t=e.target.dataset.id,n=document.getElementById("clientsname"+t).innerHTML,a=document.getElementById("clientslastname"+t).innerHTML,o=document.getElementById("phone"+t).innerHTML,i=document.getElementById("email"+t).innerHTML,c=document.getElementById("date"+t).innerHTML,d=document.getElementById("time"+t).innerHTML,r=document.getElementById("numpeople"+t).innerHTML,s=JSON.stringify({name:n,lastname:a,phone:o,email:i,date:c,time:d,numberofpeople:r,id:t});1==confirm("Are you sure you want to update the booking?")?fetch(urlB+"?id="+t,{method:"PUT",headers:{"content-type":"application/json"},body:s}).then((function(e){if(200!=e.status)throw alert("Impossible to choose time in the past!"),Error("Impossible to choose time in the past!");return e.json()})).then((function(e){alert("Booking updated!"),getBookings()})):(alert("Updates cancelled!"),getBookings())}function displayMenu(e){var t=document.getElementById("pizza");t.innerHTML="";var n=document.getElementById("pasta");n.innerHTML="";var a=document.getElementById("drinks");a.innerHTML="";var o=document.getElementById("desserts");o.innerHTML="",e.forEach((function(e){"Pizza"==e.category&&(t.innerHTML+='<div class="mealDiv">\n                <b> <p id="mealname'.concat(e.id,'" contenteditable>').concat(e.name,'</p></b>\n                <p><b>Category: </b><span id="category').concat(e.id,'" contenteditable>').concat(e.category,'</span></p>\n                <p><b>Description: </b><span id="description').concat(e.id,'" contenteditable>').concat(e.description,'</span></p>\n                <p><b>Price: </b><span id="price').concat(e.id,'" contenteditable>').concat(e.price,'</span> kr</p>\n                <p><button data-id="').concat(e.id,'" class="update">UPDATE</button>\n                <button data-id="').concat(e.id,'" class="delete">DELETE</button></p>\n                </div>')),"Pasta"==e.category&&(n.innerHTML+='<div class="mealDiv">\n                <b> <p id="mealname'.concat(e.id,'" contenteditable>').concat(e.name,'</p></b>\n                <p><b>Category: </b><span id="category').concat(e.id,'" contenteditable>').concat(e.category,'</span></p>\n                <p><b>Description: </b><span id="description').concat(e.id,'" contenteditable>').concat(e.description,'</span></p>\n                <p><b>Price: </b><span id="price').concat(e.id,'" contenteditable>').concat(e.price,'</span> kr</p>\n                <p><button data-id="').concat(e.id,'" class="update">UPDATE</button>\n                <button data-id="').concat(e.id,'" class="delete">DELETE</button></p>\n                </div>')),"Drink"==e.category&&(a.innerHTML+='<div class="mealDiv">\n                <b> <p id="mealname'.concat(e.id,'" contenteditable>').concat(e.name,'</p></b>\n                <p><b>Category: </b><span id="category').concat(e.id,'" contenteditable>').concat(e.category,'</span></p>\n                <p><b>Description: </b><span id="description').concat(e.id,'" contenteditable>').concat(e.description,'</span></p>\n                <p><b>Price: </b><span id="price').concat(e.id,'" contenteditable>').concat(e.price,'</span> kr</p>\n                <p><button data-id="').concat(e.id,'" class="update">UPDATE</button>\n                <button data-id="').concat(e.id,'" class="delete">DELETE</button></p>\n                </div>')),"Dessert"==e.category&&(o.innerHTML+='<div class="mealDiv">\n                <b> <p id="mealname'.concat(e.id,'" contenteditable>').concat(e.name,'</p></b>\n                <p><b>Category: </b><span id="category').concat(e.id,'" contenteditable>').concat(e.category,'</span></p>\n                <p><b>Description: </b><span id="description').concat(e.id,'" contenteditable>').concat(e.description,'</span></p>\n                <p><b>Price: </b><span id="price').concat(e.id,'" contenteditable>').concat(e.price,'</span> kr</p>\n                <p><button data-id="').concat(e.id,'" class="update">UPDATE</button>\n                <button data-id="').concat(e.id,'" class="delete">DELETE</button></p>\n                </div>'))}));for(var i=document.getElementsByClassName("delete"),c=document.getElementsByClassName("update"),d=0;d<i.length;d++)i[d].addEventListener("click",deleteMeal),c[d].addEventListener("click",updateMeal)}function deleteMeal(e){var t=e.target.dataset.id;1==confirm("Are you sure you want to delete the meal?")?fetch(urlA+"?id="+t,{method:"DELETE"}).then((function(e){return e.json()})).then((function(e){alert("Menu updated!"),getMenu()})).catch((function(e){return console.log(e)})):getMenu()}function updateMeal(e){var t=e.target.dataset.id,n=document.getElementById("mealname"+t).innerHTML,a=document.getElementById("description"+t).innerHTML,o=document.getElementById("category"+t).innerHTML,i=document.getElementById("price"+t).innerHTML,c=JSON.stringify({name:n,description:a,price:i,category:o,id:t});1==confirm("Are you sure you want to save changes?")?fetch(urlA+"?id="+t,{method:"PUT",headers:{"content-type":"application/json"},body:c}).then((function(e){return e.json()})).then((function(e){alert("Menu updated!"),getMenu()})).catch((function(e){return console.log(e)})):(alert("Updates cancelled!"),getMenu())}function clearForm(){mealNameInput.value="",categoryInput.value="",priceInput.value="",descriptionInput.value="",getMenu()}submitLogout.addEventListener("click",logoutUser),submitInput.addEventListener("click",addMeal),window.onload=init;